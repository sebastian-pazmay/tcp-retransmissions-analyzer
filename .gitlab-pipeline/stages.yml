.build_image:
  stage: build
  script:
    - $PYTHON_SCRIPT= echo $CI_JOB_NAME | cut -d'_' -f 2-
    - docker build -t $CI_REGISTRY_IMAGE:$PYTHON_SCRIPT.$CI_COMMIT_SHORT_SHA  --build-arg SCRIPT=$PYTHON_SCRIPT -f Dockerfile .
    - docker push $CI_REGISTRY_IMAGE:$PYTHON_SCRIPT.$CI_COMMIT_SHORT_SHA

.test_image:
  stage: test
  script:
    - $PYTHON_SCRIPT= echo $CI_JOB_NAME | cut -d'_' -f 2-
    - docker pull $CI_REGISTRY_IMAGE:$PYTHON_SCRIPT.$CI_COMMIT_SHORT_SHA
    - docker run $CI_REGISTRY_IMAGE:$PYTHON_SCRIPT.$CI_COMMIT_SHORT_SHA
